<VirtualHost *:80>
    ServerAdmin *********@*********
    DocumentRoot /var/www/html

    <Directory /var/www/html>
        Options Indexes FollowSymLinks
        AllowOverride All
        Require all granted

        RewriteEngine On
        RewriteBase /

        # Remove trailing slashes
        RewriteCond %{REQUEST_FILENAME} !-d
        RewriteRule ^(.*)/$ /$1 [L,R=301]

        # Serve index.html for root requests
        RewriteRule ^$ index.html [L]

        # Remove /lo-capacity or /hi-capacity from the end of the URL
        RewriteRule ^(.+)/(lo|hi)-capacity/?$ $1 [L]

        # If the file doesn't exist, try without /lo-capacity or /hi-capacity
        RewriteCond %{REQUEST_FILENAME} !-f
        RewriteCond %{REQUEST_FILENAME} !-d
        RewriteRule ^(.+)/(lo|hi)-capacity/(.*)$ $1/$3 [L]

        # Rewrite for lo-capacity
        RewriteRule ^quote\.php/lo-capacity(.*)$ quote.php?capacity=lo$1 [QSA,L]

        # Rewrite for hi-capacity
        RewriteRule ^quote\.php/hi-capacity(.*)$ quote.php?capacity=hi$1 [QSA,L]

        # Serve index.html if directory is requested
        DirectoryIndex index.html
    </Directory>

    ErrorLog ${APACHE_LOG_DIR}/error.log
    CustomLog ${APACHE_LOG_DIR}/access.log combined
</VirtualHost>
